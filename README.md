# Users API â€” POST /users/register âœ…

**Path:** `POST /users/register`

**Description:**
Registers a new user. The endpoint accepts a JSON body containing a `fullName` object, `email`, and `password`. Passwords are hashed before storage and are not returned in responses.

---

## Request

- **Headers:**
  - `Content-Type: application/json`

- **Body (example):**

```json
{
  "fullName": { "firstName": "Jane", "lastName": "Doe" },
  "email": "jane.doe@example.com",
  "password": "secret123"
}
```

## Validation

- `fullName.firstName` â€” required, minimum 3 characters
- `email` â€” required, must be a valid email
- `password` â€” required, minimum 6 characters

Validation failures return status **422 Unprocessable Entity** with the standard `express-validator` errors array.

---

## Responses

### Success â€” 201 Created âœ…

- **Example response:**

```json
{
  "user": {
    "_id": "60f7a0b7c2a2b84f394a1cd4",
    "fullName": { "firstName": "Jane", "lastName": "Doe" },
    "email": "jane.doe@example.com",
    "socketId": null,
    "__v": 0
  },
  "token": "<JWT_TOKEN_HERE>"
}
```

Notes:
- The returned `user` does not include the `password` field (it is excluded in the model with `select: false`).
- The `token` is a JWT generated by `user.generateAuthToken()` and expires in **7 days**.

### Validation error â€” 422 Unprocessable Entity âš ï¸

- **Example:**

```json
{
  "errors": [
    {
      "msg": "Please provide a valid email address.",
      "param": "email",
      "location": "body"
    }
  ]
}
```

### Bad request â€” 400 Bad Request â—

- **Example:**

```json
{ "message": "All fields are required." }
```

### Server error â€” 500 Internal Server Error ğŸ’¥

- **Example:**

```json
{ "message": "Internal Server Error" }
```

---

## Implementation notes ğŸ”§

- Route file: `backend/routes/user.routes.js`
- Controller: `backend/controllers/user.controller.js`
- Model: `backend/models/user_model.js`

Important details:
- Passwords are hashed using `bcrypt` before being stored (`userModel.hashPassword`).
- JWT signing uses `process.env.JWT_SECRET_KEY` â€” ensure the env var is set in your environment.
- The model currently does not enforce uniqueness on `email` (consider adding `unique: true` to the schema if you require unique emails).

---

## Users API â€” POST /users/login âœ…

**Path:** `POST /users/login`

**Description:**
Authenticates an existing user using `email` and `password`. On success the endpoint returns the authenticated `user` object (without password) and a JWT token that can be used for authenticated requests.

---

## Request

- **Headers:**
  - `Content-Type: application/json`

- **Body (example):**

```json
{
  "email": "jane.doe@example.com",
  "password": "secret123"
}
```

## Validation

- `email` â€” required, must be a valid email
- `password` â€” required

Validation failures return status **422 Unprocessable Entity** with an `errors` array (same format as `express-validator`).

---

## Responses

### Success â€” 200 OK âœ…

- **Example response:**

```json
{
  "user": {
    "_id": "60f7a0b7c2a2b84f394a1cd4",
    "fullName": { "firstName": "Jane", "lastName": "Doe" },
    "email": "jane.doe@example.com",
    "socketId": null,
    "__v": 0
  },
  "token": "<JWT_TOKEN_HERE>"
}
```

Notes:
- The `token` is a JWT generated by `user.generateAuthToken()` and expires in **7 days**.
- The `password` field is never returned.

### Invalid credentials â€” 400 Bad Request â—

- **Example:**

```json
{ "message": "Invalid email or password." }
```

### Validation error â€” 422 Unprocessable Entity âš ï¸

- **Example:**

```json
{
  "errors": [
    {
      "msg": "Please provide a valid email address.",
      "param": "email",
      "location": "body"
    }
  ]
}
```

### Server error â€” 500 Internal Server Error ğŸ’¥

- **Example:**

```json
{ "message": "Internal Server Error" }
```

---

## Implementation notes ğŸ”§

- Suggested route: add `POST /login` to `backend/routes/user.routes.js` (e.g., `router.post('/login', [...validators], userController.loginUser)`).
- Controller: `backend/controllers/user.controller.js` â€” implement `loginUser` that:
  - finds the user by email (use `.select('+password')` to include password),
  - calls `user.comparePassword(password)` to verify password,
  - returns `{ user, token }` on success (exclude password before sending response).
- Ensure `process.env.JWT_SECRET_KEY` is set for JWT signing.

---


